# 操作系统的访问控制设计实例研究

## 实验目的

* 通过 iOS 或Android 系统为研究对象，进行访问控制的理解和设计。
* 本次实验以自己手机 `Harmony鸿蒙` 系统为研究对象


## 实验环境

* 操作系统版本：HarmonyOS 2.0.0
* 硬件设备型号：HMA-AL00 （Mate 20）

## 实验结果
        
* 当系统处于锁屏状态下接收到新短信时，不解锁情况下
  * 系统是否允许查看短信内容？**否**
  * 系统是否允许回复短信？**否**
  * 安卓上的 App : 以 **畅连** 为例，在接管了系统短信功能和权限之后，是否会有一些不同的功能设定？如下图
  ![](img/changlian%20permission.png)
        
* 当系统处于锁屏状态下，使用系统内置（例如 iOS 的 Siri ）或第三方的语音助手可以完成以下哪些操作？

  * 以下所有操作都需要语音助手对说话人进行声纹识别，非机主不能进行唤起。

    * 访问通讯录：**不能访问通讯录，需要解锁手机**
    * 拨打电话：**能成功实现**
    * 访问相册：**不能访问相册，需要解锁手机**
    * 查看短信收件箱：**不能查看收件箱，需要解锁手机**

* 实验并分析指纹识别**相比较于**简单密码、复杂密码、图形解锁、人脸识别解锁、声纹解锁等解锁方式的安全性、便利性差异。

| 相比于指纹识别 |    简单密码    |      复杂密码      |                        图形解锁                        |                       人脸识别解锁                       |                 声纹解锁                 |
| :----------------: | :------------: | :----------------: | :----------------------------------------------------: | :------------------------------------------------------: | :--------------------------------------: |
|       安全性       |  指纹识别更强  | 复杂密码安全性更高 |         图形解锁存在图案简单，可能被偷窥的可能         |                          差不多                          | 声纹解锁安全性更高但是辨别准确度存在问题 |
|       便利性       | 指纹识别更便利 |   指纹识别更便利   | 图形更便利（在手指非干燥条件下，指纹通常无法正确识别） | 指纹识别更便利（以亲身经历来说，人脸识别解锁准确率较低） |              指纹识别更便利              |

---

* 思考题：
  
  * 以上设计实现方式属于我们课堂上讲过的哪种强制访问控制模型？Lattice/BLP？Biba？
  
    * `Biba模型`，可以上读下写，锁屏时只能读短信，属于**上读**；解开屏幕以后，可以回复短信，属于**下写**。
  
  * 系统或第三方应用程序是否提供了上述功能的访问控制规则修改？如果修改默认配置，是提高了安全性还是降低了安全性？
  
    * 系统或第三方应用程序提供了上述功能的访问控制规则修改，可以修改权限。我认为降低了安全性，这相当于脱离了操作系统的控制。如果随意修改默认配置，会赋予App应用不同的权限，其中包括位置信息、通讯录、信息等多个敏感权限。

## 课后思考

### 1.  生物特征身份认证方式有哪些？优缺点分析？应用场景举例。

**指纹识别**

- 优点
  - 实用性强，指纹样本便于获取，易以开发识别系统;
  - 可靠性易以增加，可以通过登记更多的指纹，鉴别更多的手指来提高其准确度;
  - 方便性好，扫描指纹的速度很快，使用非常方便;
  - 应用广泛，指纹识别技术占领了大部分市场;
  - 指纹识别产品的性价比较好，指纹采集头更加小型化，并且价格低廉。
- 缺点
  - 指纹的广泛性较差，个别人或某些群体的指纹因为指纹文特征很少，成像很难，对该技术的应用有一定的影响;
  - 用户接受性较差。过去因为在犯罪记录中使用指纹，使用户在使用上存在一定的心理障碍 。
- 应用场景
  - 计算机网络安全：在计算机上将指纹识别与传统身份认证相结合，防止密码忘记或被别人窃取时产生的安全威胁；
  - 金融机构：银行等机构进行员工身份认证、自动取款机客户的身份认证、移动支付的安全认证等；
  - 政府机关、企事业单位：主要用于对管理人员进行授权和身份认证、考勤、安全区域员工身份验证，数据库访问安全控制等方面；
  - 教育、医疗、司法机构：学校通过门禁控制对学生及工作人员进行身份认证；医院等对私人信息的安全认证，使最终用户能够安全方便的查询和验证相关手续、病人和捐赠者的鉴定，防止欺诈性捐助等；公安司法机关利用指纹验证解决方案，快速有效的鉴别危险罪犯，以保障公民安全；
  - 边境控制，机场、港口出入境人员护照、签证等上的身份认证，以及边境检查中进行“黑名单”筛查等。

**人脸识别**

- 优点
  - 具有主动性
  - 非侵犯性
  - 用户友好
- 缺点
  - 精确性低，目前的人脸识别方法主要集中在二维图像方面，由于受到光照、姿势、表情变化的影响，识别的准确度受到很大的限制;
  - 成本较高，面像识别技术的改进依赖于提取特征与比对技术的提高，采集图像的设备较为昂贵。 
- 应用场景
  - 远程刷脸登录
  - 刷脸门禁
  - 抓拍捕捉人脸发现可疑人物
  - 智能相册分类
  - 辅助密码 

**声音识别**

- 优点
  - 声音识别是一种非接触的识别技术，用户可以很自然地接接受;
  - 声音识别技术具有较好的方便性、经济性和准确性。
- 缺点
  - 精确度较低，声音因为变化的范围太大，很难进行精确的匹配;
  - 技术复杂度较高，声音的音量、速度和音质会受一定的条件，如感冒的影响，需增加系统功能以适应该变化;
  - 成本较高，声音采集设备，如高保真的麦克区风，是很昂贵的。  
- 应用场景
  - 语音输入
智能语音输入，可摆脱生僻字和拼音障碍，由实时语音识别实现，为用户节省输入时间、提升输入体验。
  - 语音搜索
语音识别技术可用于语音搜索中，将搜索的内容直接以语音的方式输入，应用于手机搜索、网页搜索、车载搜索等多种搜索场景，很好地解放了人们的双手，让搜索变得更加高效。
  - 语音指令
语音识别技术可用于语音指令中，不需要手动操作，可通过语音直接对设备或者软件发布命令，控制其进行操作，适用于视频网站、智能硬件等各大搜索场景。
  - 字幕生成
语音识别技术可用于字幕生成中，可将直播和录播视频中的语音转换为文字，可以轻松便捷地生成字幕。



**虹膜识别**

- 优点
  - 生物特征的采集较为方便，准确性较高。据统计，到目前为止，虹膜，识别的错误率是各种生物特征识别中最低的。 
- 缺点
  - 应用普及程序较低，虹膜识别系统已经进行了许多测试， 但还没有更大规模的应用;
  - 成本较高，很难将图像获取设备的尺寸小型化，同时需要昂贵的摄像头。
- 应用场景
  - 安防设备（如门禁等），以及有高度保密需求的场所 。

**视网膜识别**

- 优点
  - 视网膜的生物特征具有较强的优势，视网膜是--种极其其固定的生物特征，因为它是“隐藏”的，不易磨损、老化或者受疾病的影响;视网膜识别技术有较高的准确性和防伪性。
- 缺点
  -  应用技术的广泛性差，应用普及程度不高;消费者的接受受性较低，视网膜技术是否会给使用者带来健康的损坏有待进一步的医学证实，影响了其应用前景;视网膜识别技术的成本较高。

**其他生物特征识别技术：掌纹识别、手形识别、人耳识别等。**



### 2.  “找回口令功能”和“忘记密码”在访问授权机制中的意义？请尝试设计几种安全的“找回口令功能”，详细描述找回口令的用户具体操作过程。

- 意义：

  ​	 “找回口令功能”和“忘记密码”是在真正被授权用户忘记口令时重新获取权限的方式，从而对客体能够正常访问

- “找回口令功能”方案设计：

  - 基于“双因素认证”。
  
    > 双因素认证是一种采用时间同步技术的系统，采用了基于时间、事件和密钥三变量而产生的一次性密码来代替传统的静态密码。每个动态密码卡都有一个唯一的密钥，该密钥同时存放在服务器端，每次认证时动态密码卡与服务器分别根据同样的密钥，同样的随机参数（时间、事件）和同样的算法计算了认证的动态密码，从而确保密码的一致性，从而实现了用户的认证。因每次认证时的随机参数不同，所以每次产生的动态密码也不同。由于每次计算时参数的随机性保证了每次密码的不可预测性，从而在最基本的密码认证这一环节保证了系统的安全性。解决因口令欺诈而导致的重大损失，防止恶意入侵者或人为破坏，解决由口令泄密导致的入侵问题。
  
    安全假设是用户有一台可信任设备(比如用户的手机、USB KEY等),在用户使用找回口令功能的时候，服务器能够向可信任设备发送一个动态密码，只有用户在网页上输入该动态密码才能进行口令更改。
  
    
  
    注：此处动态密码可根据成本进行更换，包括：手机短信密码、混合型令牌（USBKEY+[动态口令](https://baike.baidu.com/item/动态口令)）等



### 3.  绘制用户使用用户名/口令+图片验证码方式录系统的流程图。考虑认证成功和失败两种场景，考虑授权成功和失败两种场景。

![](img/%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F%E6%B5%81%E7%A8%8B%E5%9B%BE.png)

### 4. Windows XP / 7 中的访问控制策略有哪些？访问控制机制有哪些？

   **Windows xp/7**：

   - 访问控制策略：
      - 基于角色的访问控制
          在Windows XP中，有一群不为人知的用户，它们的作用是可以让我们指派权限到某种"状态"的用户(如"匿名用户"、"网络用户")等，而不是某个特定的用户或组(如 "zhong"、"CPCW"这类用户)。这样一来，对用户权限的管理就更加容易精确控制了。这群用户在Windows XP中，统一称为**内置安全主体**。

     > Windows XP对访问控制方面的策略做了较多的改进。主要有，限制网络用户为来宾账号的策略，空口令限制策略，借助Microsoft Passport实现的单一登录方式，针对漫游用户的凭证管理等。例如，凭证管理特性为包括密码和X.509证书在内的用户凭证提供了安全的存储方式。该特性为包括漫游用户在内的所有用户提供了一致性的单一签名体验。如果用户需要访问公司网络中的一个应用程序，那么，在首次进行尝试时，用户需要进行身份验证，并根据提示信息提供一个凭证。在提供该凭证后，它将与所请求的应用程序建立关联。今后，当用户再次访问该应用程序时，原先所保存的凭证将在无需重新输入的情况下再次使用。
     
        - 强制访问控制
     
           用户在登陆时，登陆主机的系统首先把用户输入的用户名等信息传送给安全账号管理器，安全账号管理器将这些信息与SAM数据库中的信息进行比较。比较结果，如果匹配，服务器发给工作站允许访问的信息，并返回用户的安全标识，每次用户对系统进行操作时，系统都会将用户的SID与安全描述符中的自主访问控制表进行比较，从而决定用户是否有权访问对象。
     
   - 访问控制机制

      - 系统为共享资源创建的安全描述符包含了该对象的一组安全属性：1. 所有者安全标识。2. 组安全标识。3. 自主访问控制表（DAC）4. 系统访问控制表（ACL）


### 5.  用权限三角形模型来理解并描述下 2 种威胁模型：提权、仿冒。
- 权限三角形模型：用户 - 角色（分级）- 权限（对象+操作） 如图
![](img/%E6%9D%83%E9%99%90%E4%B8%89%E8%A7%92%E6%A8%A1%E5%9E%8B.png)

- 提权：
>  分为水平特权提升、垂直特权提升。 提权是指本来没有某项权限的用户，通过一定的方法获得该权限，简而言之，用户以自己的身份获得了本不属于自己的权限

- 水平权限提升举例：

>  我们假设攻击者已经获得了在线银行账户的访问权限。她的目的是窃取金钱，但她从这一个账户中窃取的金钱并不多。这时，她就会寻找信息或尝试[各种漏洞利用途径](https://www.exploit-db.com/webapps/)来获得对其他账户的访问权限。这称之为*水平权限提升*，因为攻击者是在具有相似权限的账户中横向移动。她是如何横向移动的？攻击者可以在她登录后检查该银行返回的超链接，查看是否透露有关内容在该银行网站上的组织方式的任何信息。她可能会发现银行以特定方式在超链接中编码客户的账号。这时，她就会编写并在网址中插入超链接，以测试银行系统的安全是否存在缺陷以及是否可以利用该缺陷查看其他客户的账户数据或（更严重情形）转移资金。如果成功的话，她可以在银行检测到其活动或客户报告失窃之前访问多个账户。这称之为*直接对象引用*[技术](https://www.outpost24.com/direct-object-references-and-horizontal-privilege-escalation/)。

- 纵向权限提升举例：

> 攻击者已经未经授权获得了在计算机系统上访问用户账户的权限。他将进行[本地侦查](https://www.admin-magazine.com/Articles/Understanding-Privilege-Escalation)，查看遭到攻击的用户可以做什么和他可以访问什么信息，他是否可以从该账户编写脚本或编译程序等等。如果他能够在遭到攻击的计算机上下载和执行软件，他就可以运行恶意软件。他将到处侦查，直到发现可以加以利用的漏洞或配置错误，以便成为目标计算机的管理员，或者他也将放弃该系统并移到另一台计算机。



- 仿冒：

> 指用户A以用户B的身份通过了认证，之后行使了B所有的权利 仿冒是用户→角色，获取的角色改变，所以能够行使的权限也就因角色的改变而改变了





### 6.  试通过操作系统的访问控制机制来达到预防一种真实病毒的运行目的。

​举例 ：特洛伊木马是一种常见的恶意软件，与病毒不同，它无法自行传播。 这意味着必须手动下载它们，或者需要下载并安装其他恶意软件。特洛伊木马通常使用与真实和合法应用相同的文件名。很容易意外下载特洛伊木马，认为它是合法应用。

**特洛伊木马如何工作**

特洛伊木马可以有许多不同的种类，但通常它们会执行以下操作：

- 下载并安装其他恶意软件，如病毒或 [蠕虫](https://docs.microsoft.com/zh-cn/windows/security/threat-protection/intelligence/worms-malware)。
- 使用受感染的设备进行点击欺诈。
- 记录所访问的键击和网站。
- 将有关受感染设备的信息发送给恶意黑客，包括密码、网站的登录详细信息和浏览历史记录。
- 让恶意黑客控制受感染的设备。

​	**预防方法**

- 认证

  在检测到执行恶意操作时需要进行身份确认（比如删除、加密硬盘中的文件）

- 授权

  对进程的权限进行限制，对每个进程主体在满足正常使用的情况下赋予最小权限，当发现恶意行为时及时撤销权限。

- 审计

  对进程进行审计，当发现向未知目标发送隐私信息等类似木马行为时终止该恶意进程。



### 7.  什么是 OAuth？

  OAuth (" Open Auth orization") 是访问授权的开放标准，通常用作互联网用户授予网站或应用程序访问其在其他网站上的信息但不给他们密码的一种方式。
  
**名词定义**
 - （1） Third-party application：第三方应用程序，又称"客户端"（client）。
  - （2）HTTP service：HTTP服务提供商，简称"服务提供商"。
  - （3）Resource Owner：资源所有者，又称"用户"（user）。
  - （4）User Agent：用户代理，本文中就是指浏览器。
  - （5）Authorization server：认证服务器，即服务提供商专门用来处理认证的服务器。
  - （6）Resource server：资源服务器，即服务提供商存放用户生成的资源的服务器。它与认证服务器，可以是同一台服务器，也可以是不同的服务器。
  - **OAuth的作用就是让"客户端"安全可控地获取"用户"的授权，与"服务商提供商"进行互动。**
  
**OAuth的思路**

- OAuth在"客户端"与"服务提供商"之间，设置了一个授权层（authorization layer）。"客户端"不能直接登录"服务提供商"，只能登录授权层，以此将用户与客户端区分开来。"客户端"登录授权层所用的令牌（token），与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。

- "客户端"登录授权层以后，"服务提供商"根据令牌的权限范围和有效期，向"客户端"开放用户储存的资料。

**运行流程**

下图摘自RFC 6749

![](img/OAuth%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B.png)

（A）用户打开客户端以后，客户端要求用户给予授权。

（B）用户同意给予客户端授权。

（C）客户端使用上一步获得的授权，向认证服务器申请令牌。

（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌。

（E）客户端使用令牌，向资源服务器申请获取资源。

（F）资源服务器确认令牌无误，同意向客户端开放资源。

上面六个步骤之中，B是关键，即用户怎样才能给于客户端授权。有了这个授权以后，客户端就可以获取令牌，进而凭令牌获取资源。


### 8.  什么是 OpenID？

OpenID 是一个以用户为中心的数字身份识别框架，它具有开放、分散、自由等特性。

OpenID 的创建基于这样一个概念：我们可以通过 URI （又叫 URL 或网站地址）来认证一个网站的唯一身份，同理，我们也可以通过这种方式来作为用户的身份认证。 由于URI 是整个网络世界的核心，它为基于URI的用户身份认证提供了广泛的、坚实的基础。

OpenID 系统的第一部分是身份验证， 即如何通过 URI 来认证用户身份。 目前的网站都是依靠用户名和密码来登录认证，这就意味着大家在每个网站都需要注册用户名和密码， 即便你使用的是同样的密码。如果使用 OpenID （参见规范）， 你的网站地址（URI）就是你的用户名， 而你的密码安全的存储在一个 OpenID 服务网站上 （你可以自己建立一个 OpenID 服务网站，也可以选择一个可信任的 OpenID 服务网站来完成注册）。

登录一个支持 OpenID 的网站非常简单（即便你是第一次访问这个网站也是一样）。 只需要输入你注册好的 OpenID 用户名，然后你登录的网站会跳转到你的 OpenID 服务网站， 在你的 OpenID 服务网站输入密码（或者其它需要填写的信息）验证通过后， 你会回到登录的网站并且已经成功登录。 OpenID 系统可以应用于所有需要身份验证的地方， 既可以应用于单点登录系统，也可以用于共享敏感数据时的身份认证。

除了一处注册，到处通行以外，OpenID 给所有支持 OpenID 的网站带来了价值－－共享用户资源。 用户可以清楚的控制哪些信息可以被共享，例如姓名、地址、电话号码等。


### 9.  试用本章所学理论分析 OAuth 和 OpenID 的区别与联系。

**OpenID是Authentication（认证）**
**OAuth是Authorization（授权）**
OAuth关注的是授权，即：“用户能做什么”；而OpenID关注的是证明，即：“用户是谁”。
**认证不一定授权，但授权必然包含了认证。**

以下用OpenID和Oauth的具体过程步骤对照说明两者的区别与联系。

**OpenID**
1. 用户希望访问其在example.com的账户
2. example.com (在OpenID的黑话里面被称为“Relying Party”) 提示用户输入他/她/它的OpenID
3. 用户给出了他的OpenID，比如说”http://user.myopenid.com”
4. example.com 跳转到了用户的OpenID提供商“mypopenid.com”        （example.com向myopenid.com请求凭证）
5. 用户在”myopenid.com”(OpenID provider)提示的界面上输入用户名密码登录        （myopenid.com验证用户身份）
6. “myopenid.com” (OpenID provider) 问用户是否要登录到example.com           （向用户确认是否向example.com提供凭证）
7. 用户同意后，”myopenid.com” (OpenID provider) 跳转回example.com        （example.com验证myopenid.com的凭证）
8. example.com 允许用户访问其帐号
   
**OAuth**
1. 用户在使用example.com时希望从mycontacts.com导入他的联系人
2. example.com (在OAuth的黑话里面叫“Consumer”)把用户送往mycontacts.com (黑话是“Service Provider”)      （向mycontact.com发送授权请求）
3. 用户在mycontacts.com 登录(可能也可能不用他的OpenID)    （验证用户身份）
4. mycontacts.com问用户是不是希望授权example.com访问他在mycontact.com的联系人 (mycontact.com向用户确认是否授权)
5. 用户确定（用户确认授权）
6. mycontacts.com 把用户送回example.com                  （mycontacts.com向example.com授权）
7. example.com 从mycontacts.com拿到联系人            （通常，拿到用户信息就意味着证明了用户身份）
8. example.com 告诉用户导入成功

![](/img/openid_vs_oauth.png)

OpenID和OAuth都是基于HTTP的身份验证和/或授权协议。这两种方法都允许用户在不向客户端或第三方提供身份验证凭据或覆盖权限的情况下执行操作。虽然它们很相似，并且有建议的标准可以同时使用它们，但是它们是独立的协议。

OpenID用于联合身份验证。客户机接受来自任何提供程序的身份声明(尽管客户机可以自由使用白名单或黑名单提供程序)。

OAuth用于委托授权。客户机向提供者注册，提供者提供授权令牌，它将接受这些令牌以代表用户执行操作。

OAuth目前更适合授权，因为认证后的进一步交互是内置在协议中的，但这两种协议都在不断发展。OpenID及其扩展可以用于授权，OAuth可以用于身份验证，这可以被认为是一种无操作授权。



### 10.  如何使用 OAuth 和 OpenID 相关技术实现单点登录（Single Sign On）？

![](./img/sso.png)

1. 当用户第一次登录时，将用户名密码发送给用户服务
2. 验证用户将用户标识OpenId返回到客户端
3. 客户端进行存储
4. 访问子系统,将OpenId发送到子系统
5. 子系统将OpenId转发到验证服务
6. 验证服务将用户认证信息返回给子系统
7. 子系统构建用户验证信息后将授权后的内容返回给客户端

---

## 参考文献
- [理解OAuth 2.0](https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)
- [What's the difference between OpenID and OAuth？](https://www.codenong.com/1087031/)
- [生物识别技术](https://wiki.mbalib.com/wiki/%E7%94%9F%E7%89%A9%E8%AF%86%E5%88%AB%E6%8A%80%E6%9C%AF)
- [被“incaseformat”蠕虫病毒删除文件？不要慌，腾讯iOA、御点、管家都能杀，文件也能恢复](https://guanjia.qq.com/news/n3/2586.html)
- [单点登录（SSO）看这一篇就够了](https://developer.aliyun.com/article/636281)
